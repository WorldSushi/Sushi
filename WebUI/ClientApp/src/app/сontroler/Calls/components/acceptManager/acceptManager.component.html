<mat-card class="mat-elevation-z1">
  <mat-card-header>
    <mat-card-title class="card-title">Проверка звонков</mat-card-title>
  </mat-card-header>
  <div class="filter clearfix">
    <input (keyup)="applyFilterNumberOrname($event.target.value)" placeholder="Телефон или Название">
    <input (keyup)="applyFilterDuration($event.target.value)" placeholder="Продолжительность">
    <select [(ngModel)]="direction" (ngModelChange)="changeDirection()">
      <option [ngValue]=0>Все направленния</option>
      <option [ngValue]=1>Исходящие</option>
      <option [ngValue]=2>Входящие</option>
    </select>
    <select [(ngModel)]="selectedManager" (ngModelChange)="changeManager()">
      <option selected [ngValue]=0>Все менеджера</option>
      <option *ngFor="let elm of managers" [ngValue]=elm.id>{{elm.login}}</option>
    </select>
    <button (click)="hiddenCalendar()">{{btnDate}}</button>
    <div [hidden]="calendarHidden" class="blockCalendar">
      <div class="calendar">
        <igx-calendar (onSelection)="verifyRange($event)" selection="range"></igx-calendar>
      </div>
      <div class="sortbloc">
        <button (click)="sortDateCall(1)" class="btnSort">За всё время</button><br />
        <button (click)="sortDateCall(2)" class="btnSort">За Сегодня</button><br />
        <button (click)="sortDateCall(3)" class="btnSort">За Вчера</button><br />
        <button (click)="sortDateCall(4)" class="btnSort">За Последние 7 Дней</button><br />
        <button (click)="sortDateCall(5)" class="btnSort">3а Последние 30 Дней</button><br />
        <button (click)="sortDateCall(6)" class="btnSort">За Текущая неделя</button><br />
        <button (click)="sortDateCall(7)" class="btnSort">За Текущая Месяц</button><br />
        <button (click)="sortDateCall(8)" class="btnSort">За Текущий год</button><br />
      </div>
    </div>
  </div>
  <div class="bodyAll">


    <mat-paginator [pageSizeOptions]="[10, 20, 30, 40, 50, 60, 70, 80, 90, 100]" showFirstLastButtons></mat-paginator>
    <mat-table mat-table [dataSource]="dataSource" matSort>

      <ng-container matColumnDef="status">
        <th colspan="1" mat-header-cell *matHeaderCellDef></th>
        <td colspan="1" mat-cell *matCellDef="let element" [style.background]="setBagroundStatus(element)"></td>
      </ng-container>

      <ng-container matColumnDef="statusCall">
        <th colspan="4" mat-header-cell *matHeaderCellDef>Статус</th>
        <td colspan="4" mat-cell *matCellDef="let element"><span *ngIf="element.contactType != 50"> {{element.contactType == 40 ? "Подтверждён" : "Не подтвержден"}}</span></td>
      </ng-container>

      <ng-container matColumnDef="direction">
        <th colspan="4" mat-header-cell *matHeaderCellDef>Статус звонка</th>
        <td colspan="4" mat-cell *matCellDef="let element">{{element.direction}} </td>
      </ng-container>

      <ng-container matColumnDef="answer">
        <th colspan="4" mat-header-cell *matHeaderCellDef>Отвечен</th>
        <td colspan="4" mat-cell *matCellDef="let element">{{element.durations == 0 ? "Нет" : "Да"}} </td>
      </ng-container>

      <ng-container matColumnDef="title">
        <th colspan="4" mat-header-cell *matHeaderCellDef>Название</th>
        <td colspan="4" mat-cell *matCellDef="let element">{{element.titleClient}} </td>
      </ng-container>

      <ng-container matColumnDef="phone">
        <th colspan="4" mat-header-cell *matHeaderCellDef>Номер тел</th>
        <td colspan="4" mat-cell *matCellDef="let element">{{element.phone}}</td>
      </ng-container>

      <ng-container matColumnDef="duration">
        <th colspan="4" mat-header-cell *matHeaderCellDef>Продолжи..</th>
        <td colspan="4" mat-cell *matCellDef="let element" style="max-width: 300px">{{element.durations}} Сек</td>
      </ng-container>

      <ng-container matColumnDef="date">
        <th colspan="4" mat-header-cell *matHeaderCellDef>Дата</th>
        <td colspan="4" mat-cell *matCellDef="let element">{{element.date}}</td>
      </ng-container>

      <ng-container matColumnDef="comentCon">
        <th colspan="14" mat-header-cell *matHeaderCellDef>Комментарий контролера</th>
        <td colspan="14" mat-cell *matCellDef="let element">
          <textarea *ngIf="element.contactType != 50" style="width:250px;height:60px;">{{element.callsComments?.comment}}</textarea><br />
          <button *ngIf="element.contactType != 50" (click)="setNoAccept($event, element.id, element.clientId)" class="btnAccept">Отклонить</button>
          <button *ngIf="element.contactType != 50" (click)="setAccept($event, element.id, element.clientId)" class="btnAccept">Исправлено</button>
        </td>
      </ng-container>

      <ng-container matColumnDef="comentCli">
        <th colspan="7" mat-header-cell *matHeaderCellDef>Комментарий менеджера</th>
        <td colspan="7" mat-cell *matCellDef="let element">{{element.callsComments?.managerComment}}</td>
      </ng-container>

      <ng-container matColumnDef="refAudio">
        <th colspan="14" mat-header-cell *matHeaderCellDef>Аудио запись</th>
        <td colspan="14" mat-cell *matCellDef="let element"><audio style="height:20px" controls preload="none" src="{{element.referenceAudioVoice}}"></audio></td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" (dblclick)="openEditClientForm(row)"></tr>
    </mat-table>
  </div>
</mat-card>
